<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Blog Layout</title>
    <meta name="generator" content="Bootply" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/navbar.css">
    <link rel="stylesheet" type="text/css" href="css/shop.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/blog.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!--script type="text/javascript" src='js/navbar.js'></script-->
</head>
<style type="text/css">
.anibox {
    box-sizing: border-box;
    border: 1px dotted #f00;
    background-color: #f2f2f2;
    /*animation: EDITABLE 2s infinite;*/
}
</style>

<body style="background-color: #f2f2f2">
    <h1 class="text-center">Component Test Bed</h1>
    <div class="container-fluid" style="min-height: 100%" class="clearfix">
        <div class="col-md-12 blog-excerpt" style="background-color : #fff; height: 100%">
            <li class="post clearfix" id=1 style="postion:relative">
                <div class="block clearfix">
                    <div class="col-md-10">
                        <div class="editarea">
                            <span class="post-title"> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer sodales orci nec volutpat semper. Nulla a gravida ligula, a commodo lectus. Phasellus lacinia, eros sit amet rutrum accumsan, risus magna ornare metus, id elementum ipsum eros at elit. Mauris venenatis dui quis erat tincidunt, in ornare lectus blandit</span>
                            <div class="timestamp">
                                2015-09-01
                            </div>
                            <div>
                                <span class="excerpt desc">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer sodales orci nec volutpat semper. Nulla a gravida ligula, a commodo lectus. Phasellus lacinia, eros sit amet rutrum accumsan, risus magna ornare metus, id elementum ipsum eros at elit. Mauris venenatis dui quis erat tincidunt, in ornare lectus blandit. Quisque non tellus et mauris ultricies consectetur vel sit amet nibh. Donec facilisis velit nec dui ullamcorper feugiat. Sed arcu velit, fringilla a risus et, aliquam consectetur massa. Aliquam consectetur ut elit vel ullamcorper
                            </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 col-lg-2">
                        <img src="img/Products/product3.jpg" class="img-responsive center-block">
                    </div>
                </div>
            </li>
            <li class="post clearfix" id=1 style="postion:relative">
                <div class="block clearfix">
                    <div class="col-md-10">
                        <div class="editarea">
                            <span class="post-title"> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer sodales orci nec volutpat semper. Nulla a gravida ligula, a commodo lectus. Phasellus lacinia, eros sit amet rutrum accumsan, risus magna ornare metus, id elementum ipsum eros at elit. Mauris venenatis dui quis erat tincidunt, in ornare lectus blandit</span>
                            <div class="timestamp">
                                2015-09-01
                            </div>
                            <div>
                                <span class="excerpt desc">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer sodales orci nec volutpat semper. Nulla a gravida ligula, a commodo lectus. Phasellus lacinia, eros sit amet rutrum accumsan, risus magna ornare metus, id elementum ipsum eros at elit. Mauris venenatis dui quis erat tincidunt, in ornare lectus blandit. Quisque non tellus et mauris ultricies consectetur vel sit amet nibh. Donec facilisis velit nec dui ullamcorper feugiat. Sed arcu velit, fringilla a risus et, aliquam consectetur massa. Aliquam consectetur ut elit vel ullamcorper
                            </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 col-lg-2">
                        <img src="img/Products/product3.jpg" class="img-responsive center-block">
                    </div>
                </div>
            </li>
            <li class="post clearfix" id=1 style="postion:relative">
                <div class="block clearfix">
                    <div class="col-md-10">
                        <div class="editarea">
                            <span class="post-title"> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer sodales orci nec volutpat semper. Nulla a gravida ligula, a commodo lectus. Phasellus lacinia, eros sit amet rutrum accumsan, risus magna ornare metus, id elementum ipsum eros at elit. Mauris venenatis dui quis erat tincidunt, in ornare lectus blandit</span>
                            <div class="timestamp">
                                2015-09-01
                            </div>
                            <div>
                                <span class="excerpt desc">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer sodales orci nec volutpat semper. Nulla a gravida ligula, a commodo lectus. Phasellus lacinia, eros sit amet rutrum accumsan, risus magna ornare metus, id elementum ipsum eros at elit. Mauris venenatis dui quis erat tincidunt, in ornare lectus blandit. Quisque non tellus et mauris ultricies consectetur vel sit amet nibh. Donec facilisis velit nec dui ullamcorper feugiat. Sed arcu velit, fringilla a risus et, aliquam consectetur massa. Aliquam consectetur ut elit vel ullamcorper
                            </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 col-lg-2">
                        <img src="img/Products/product3.jpg" class="img-responsive center-block">
                    </div>
                </div>
            </li>
        </div>
    </div>
    <template id="ControlPanel">
        <div class="controlPanel col-md-10" style="text-align: center;">
            <button type="button" class="btn btn-default go" id='_delete'><i class="fa fa-trash-o"></i> Delete</button>
            <button type="button" class="btn btn-default go" id='_edit'><i class="fa fa-pencil-square-o"></i> Edit</button>
            <button type="button" class="btn btn-default go" id="_done"><i class="fa fa-check-square-o"></i> Done</button>
        </div>
    </template>
</body>
<script type="text/javascript">
$(document).ready(function() {
    // Make collection of emlements with class block        
    var blocks = document.querySelectorAll('.block');
    for (var i = 0; i < blocks.length; i++) {
        blocks[i].addEventListener('mouseover', function() {
            // console.log(this.clientHeight);
            addControlPanel(this);
        }, false);
        blocks[i].addEventListener('mouseout', function(_event) {
            removeControlPanel(_event, this);
        }, false);
    }

})

function addControlPanel(el) {
    // console.log('add',el);
    if (isChildElementExisted(el, '.' + 'controlPanel') == true) {
        return;
    }
    var template_content = document.querySelector('#ControlPanel').content;
    el.appendChild(document.importNode(template_content, true));
    // adding class for controlPanel
    var controlPanel = el.querySelector('.controlPanel');
    setTimeout(function() {
        controlPanel.classList.add('show');
    }, 100);
    var buttons = controlPanel.querySelectorAll('button');
    for (var i = 0; i < buttons.length; i++) {
        buttons[i].classList.remove('go');
        buttons[i].classList.add('sh');
        // Assign business function for each button
        switch (buttons[i].id) {
            case '_edit':
                buttons[i].addEventListener('click', function(_event) {
                    bnt_EditClick(_event, this, el);
                }, false);
                break;
        }
    }
}


function removeControlPanel(e, el) {
    // console.log('remove: ', el);
    var controlPanel = el.querySelector('.' + 'controlPanel');
    if (mouseTracking(e, el) == true) {
        var buttons = controlPanel.querySelectorAll('button');
        for (var i = 0; i < buttons.length; i++) {
            // buttons[i].style.display = "none";
            buttons[i].classList.remove('sh');
            buttons[i].classList.add('go');
        }
        controlPanel.classList.remove('show');
        controlPanel.classList.add('gonne');
        changeContentEditable(false, el);
        buttonState = 0;
        controlPanel.addEventListener('transitionend', function() {
            try{
                el.removeChild(controlPanel);
            }catch(err){
                // Do nothing
            }            
        }, false);
    }

}

function isChildElementExisted(parent, child) {
    if (parent.querySelectorAll(child).length > 0) {
        return true;
    }
    return false;
}

var mouse = {
    x: 0,
    y: 0
};

function mouseTracking(e, el) {
    mouse.x = e.clientX || e.pageX;
    mouse.y = e.clientY || e.pageY;
    var containerRectangle = el.getBoundingClientRect();

    if (mouse.x > containerRectangle.left && mouse.x < containerRectangle.right &&
        mouse.y > containerRectangle.top && mouse.y < containerRectangle.bottom) {
        // Mouse is inside container.
        return false;
    } else {
        // Mouse is outside container.
        return true;
    }
}
// Business functions comes here

//  bnt_EditClick, just change state of bnt_Edit and return id of parent div
// and also change state of it's contendeditable.
var buttonState;

function bnt_EditClick(_event, target, _parent) {
    
    var icon = target.querySelector('i');
    if (buttonState == 0 || typeof(buttonState) == 'undefined') {

        target.innerText = null;
        var i_c = document.createElement('i');
        i_c.classList.add("fa");
        i_c.classList.add("fa-ban");
        target.appendChild(i_c);
        target.innerHTML += " Cancel";
        target.style.color = "#f00";
        changeContentEditable(true, _parent);

        buttonState = 1;
    } else if (buttonState == 1) {

        target.innerText = null;
        var i_c = document.createElement('i');
        i_c.classList.add("fa");
        i_c.classList.add("fa-pencil-square-o");
        target.appendChild(i_c);
        target.innerHTML += " Edit";
        target.style.color = "#333";
        changeContentEditable(false, _parent);
        buttonState = 0;
    }
}


function changeContentEditable(state, el) {
    var title = el.querySelector('.post-title');
    var excerpt = el.querySelector('.excerpt');
    title.setAttribute('contentEditable', state);
    excerpt.setAttribute('contentEditable', state);
    if (state == true) {

        el.querySelector('.editarea').classList.add('anibox');
        el.querySelector('.editarea').focus();
        placeCaretAtEnd(title);
    } else {
        el.querySelector('.editarea').classList.remove('anibox');
    }

    function placeCaretAtEnd(el) {
        el.focus();
        if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
            var range = document.createRange();
            range.selectNodeContents(el);
            range.collapse(false);
            var sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
        } else if (typeof document.body.createTextRange != "undefined") {
            var textRange = document.body.createTextRange();
            textRange.moveToElementText(el);
            textRange.collapse(false);
            textRange.select();
        }
    }
}
</script>

</html>
